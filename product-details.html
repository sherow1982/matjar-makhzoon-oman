<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- سيتم تحديث العنوان والوصف عبر الجافاسكريبت -->
    <title>تفاصيل المنتج</title> 
    <meta name="description" content="">

    <link rel="stylesheet" href="style.css">
    <!-- تحميل أيقونات Font Awesome بشكل غير حاجب للعرض -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"></noscript>

</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T67556JM"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <header class="main-header">
        <!-- محتوى الهيدر الخاص بك هنا -->
    </header>

    <main class="container">
        <nav class="breadcrumb" id="breadcrumb-nav">
            <a href="index.html">الرئيسية</a> &gt; <span id="product-breadcrumb-name">المنتج</span>
        </nav>
        <div class="single-product-container">
            <div class="single-img">
                <img id="product-image" src="" alt="">
            </div>
            <div class="single-details">
                <h1 id="product-title"></h1>
                <div id="product-meta" class="product-meta-tags"></div>
                <div id="product-price-container"></div>
                <div id="product-description" style="white-space: pre-wrap;"></div>
                <button id="whatsapp-button" class="btn-whatsapp-large">
                    <i class="fab fa-whatsapp"></i> اطلب الآن عبر واتساب
                </button>
            </div>
        </div>
    </main>

    <footer class="footer">
        <!-- محتوى الفوتر الخاص بك هنا -->
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const productId = parseInt(urlParams.get('id'));

        fetch('products.json')
            .then(response => response.json())
            .then(products => {
                const product = products.find(p => p.id === productId);
                if (product) {
                    // ملء بيانات الصفحة
                    const cleanDescription = product.description.replace(/\\n|\\t/g, ' ').replace(/\s+/g, ' ').trim();
                    const metaDescription = cleanDescription.substring(0, 155) + (cleanDescription.length > 155 ? '...' : '');

                    document.title = product.title + " | مخزون عمان";
                    document.querySelector('meta[name="description"]').setAttribute("content", metaDescription);
                    document.getElementById('product-image').src = product['image link'];
                    document.getElementById('product-image').alt = product.title;
                    document.getElementById('product-title').innerText = product.title;
                    document.getElementById('product-description').innerText = product.description.replace(/\\t/g, '    ').replace(/\\n/g, '\n');

                    const priceContainer = document.getElementById('product-price-container');
                    if (product.price > product.sale_price) {
                        priceContainer.innerHTML = `<span class="price-sale">${product.sale_price.toFixed(2)} ر.ع.</span> <span class="text-through">${product.price.toFixed(2)} ر.ع.</span>`;
                    } else {
                        priceContainer.innerHTML = `<span class="price-normal">${product.sale_price.toFixed(2)} ر.ع.</span>`;
                    }
                    // ... املأ باقي العناصر

                    // *** هذا هو الجزء الأهم: إنشاء وإضافة سكيما المنتج ***
                    const schema = {
                        "@context": "https://schema.org",
                        "@type": "Product",
                        "name": product.title,
                        "image": product['image link'],
                        "description": product.description,
                        "sku": product.sku,
                        "mpn": product.sku,
                        "brand": {
                            "@type": "Brand",
                            "name": product.brand || "مخزون عمان"
                        },
                        "offers": {
                            "@type": "Offer",
                            "url": window.location.href,
                            "priceCurrency": "OMR",
                            "price": product.sale_price,
                            ...(product.price > product.sale_price && {
                                "priceValidUntil": new Date(new Date().setFullYear(new Date().getFullYear() + 1)).toISOString().split('T')[0], // Sale valid for 1 year
                                "mainPrice": product.price 
                            }),
                            "itemCondition": "https://schema.org/NewCondition",
                            "availability": "https://schema.org/InStock"
                        }
                    };

                    const schemaScript = document.createElement('script');
                    schemaScript.type = 'application/ld+json';
                    schemaScript.textContent = JSON.stringify(schema);
                    document.head.appendChild(schemaScript);
                } else {
                    document.getElementById('product-title').innerText = "المنتج غير موجود";
                }
            });
    });
    </script>

</body>
</html>